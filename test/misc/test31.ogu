type Banana {quantity}
type Grape  {quantity}
type Orange {quantity}

trait Fruit is

    def subtotal item


extend Banana
    as Fruit

    def subtotal item = 158 * (.quantity item)

extend Grape
    as Fruit

    def subtotal item = 178 * (.quantity item)


extend Orange
    as Fruit

    def subtotal item = 98 * (.quantity item)


def coupon item = reify as Fruit
                     def subtotal _ = 0.75 * (subtotal item)

                  end


[Orange{10}, Banana{15}, coupon Grape{10}]  |> map subtotal |> sum